CREATE OR REPLACE PROCEDURE MB_LOAN_STATUS(
    P_REFERENCE_ID IN VARCHAR2,
    P_SEARCH_DETAILS OUT SYS_REFCURSOR,
    P_INDICATOR OUT NUMBER
)
AS
    V_COUNT NUMBER;
    SQL_QUERY NVARCHAR2(10000);
BEGIN
    -- Check if data exists for the given P_REFERENCE_ID
    SELECT COUNT(1)
    INTO V_COUNT
    FROM SIBAWDB.TBL_FACILITY_MB
    WHERE APPLICATION_NUMBER = P_REFERENCE_ID;

    -- Set the indicator
    IF V_COUNT > 0 THEN
        P_INDICATOR := 1; -- Data exists
    ELSE
        P_INDICATOR := 0; -- Data does not exist
    END IF;

    -- Existing logic for returning details
    SQL_QUERY := 'SELECT CURRENT_STATUS, OVERALL_STATUS, LAST_ERROR_DESCRIPTION, SCHEDULER_STEP, CUSTOMER_TEMPLATE, TOTAL_SETTLEMENT_AMOUNT, CUSTOMER_BALANCE_AFTER_LOANCLOSER FROM SIBAWDB.TBL_FACILITY_MB WHERE APPLICATION_NUMBER = ''' || P_REFERENCE_ID || '''';
    OPEN P_SEARCH_DETAILS FOR SQL_QUERY;
END MB_LOAN_STATUS;